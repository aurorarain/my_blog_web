# 个人博客网站

一个现代化的个人博客网站，支持文章发布、分类管理、留言板功能，并实现**跨设备云同步**。

## ✨ 核心特性

### 🌐 跨设备云同步
- **真正的云同步**：使用 JSONBin.io 云数据库，所有设备自动同步
- **无需配置**：配置一次，所有设备自动生效
- **实时更新**：数据变更后自动同步（10秒超时保护）
- **智能合并**：自动处理多设备数据冲突

### 📝 文章管理
- **富文本编辑器**：基于 Quill.js，支持图片自由缩放
- **分类管理**：6 大分类（随笔、编程技术、算法、计算机知识、英语、数学）
- **封面图片**：支持 URL 和本地上传
- **GitHub 存储**：文章内容和图片自动上传到 GitHub（可选）

### 💬 留言板
- **访客留言**：支持匿名或设置昵称
- **密码保护**：设置密码后可删除自己的留言
- **实时同步**：留言自动同步到所有设备

### 🚀 性能优化
- **自动更新**：检测新版本自动清除缓存
- **智能缓存**：Service Worker 实现离线访问
- **懒加载**：图片按需加载
- **防抖节流**：减少不必要的网络请求
- **超时控制**：10秒同步超时，避免长时间等待

### 🌍 多语言支持
- 中文/英文界面切换
- 自动翻译所有 UI 元素

---

## 🚀 快速开始

### 第 1 步：配置 JSONBin（必需）

#### 1.1 注册账号

1. 访问 [https://jsonbin.io/](https://jsonbin.io/)
2. 点击 **Sign Up** 注册（支持 Google/GitHub 快速登录）

#### 1.2 创建 API Key

1. 登录后点击右上角头像 → **API Keys**
2. 点击 **Create Access Key**
3. 名称输入：`MyBlog`
4. 权限选择：**Read & Write**
5. 点击 **Create Key**
6. **复制 API Key**（格式：`$2a$10$xxxxxxxxxxxxx`）

#### 1.3 创建 Bin

1. 点击 **Bins** → **Create Bin**
2. 输入以下内容：

```json
{
  "posts": [],
  "messages": [],
  "lastModified": 0,
  "version": "1.0.5"
}
```

3. 点击 **Create**
4. **复制 Bin ID**（格式：`679d5e8ead19ca34f8f1e8a7`）

#### 1.4 配置到代码

打开 `app.js`，找到第 15-17 行，替换为您的配置：

```javascript
const JSONBIN_BIN_ID = '您的_BIN_ID'
const JSONBIN_API_KEY = '您的_API_KEY'
```

### 第 2 步：配置个人信息

编辑 `app.js` 文件：

```javascript
// 个人信息
const USER_NAME_ZH = '你的名字'
const USER_BIO_ZH = '你的简介'
const USER_CONTACT = [
    { type: 'Email', value: 'your@email.com' },
    { type: 'GitHub', value: 'https://github.com/yourusername' }
]

// 管理员密码（用于发布/编辑/删除文章）
const MASTER = 'your_password'
```

### 第 3 步：配置 GitHub（可选）

用于存储文章内容和图片，提供无限容量：

```javascript
const DATA_REPO_OWNER = 'your-github-username'
const DATA_REPO_NAME = 'your-repo-name'
```

**获取 GitHub Token**：
1. 访问 [https://github.com/settings/tokens](https://github.com/settings/tokens)
2. 点击 **Generate new token (classic)**
3. 勾选 `repo` 权限
4. 生成并保存 Token

发布文章时输入 Token 即可自动同步到 GitHub。

### 第 4 步：部署

将所有文件上传到网站服务器即可。

---

## 📖 使用说明

### 发布文章

1. 点击"发布文章"
2. 填写标题、简介、分类、封面
3. 输入管理员密码
4. 点击"编辑正文"进入富文本编辑器
5. 编写内容后点击"保存"
6. 系统自动同步到云端
7. **同步成功后**才会刷新界面并提示成功
8. **同步失败**会提示错误并回滚操作

### 发布留言

1. 输入昵称（可选）和密码（可选）
2. 输入留言内容
3. 点击"发布"
4. 系统自动同步到云端
5. **同步成功后**才会显示留言并提示成功
6. **同步失败**会提示错误并回滚操作

### 删除文章/留言

1. 点击删除按钮
2. 输入密码确认
3. 系统自动同步到云端
4. **同步成功后**才会刷新界面并提示成功
5. **同步失败**会提示错误并回滚操作

### 跨设备访问

在任何设备打开网站，数据会自动从云端加载，无需任何配置！

---

## 📦 存储架构

### 双重存储方案

| 数据类型 | 存储位置 | 容量限制 | 同步速度 | 是否必需 |
|---------|---------|---------|---------|---------|
| 文章元数据 | JSONBin | 100KB | 实时 | ✅ 必需 |
| 留言数据 | JSONBin | 100KB | 实时 | ✅ 必需 |
| 文章内容 | GitHub | 1GB | 按需加载 | ⚠️ 可选 |
| 文章图片 | GitHub | 1GB | CDN加速 | ⚠️ 可选 |

### 工作流程

```
发布文章/留言
    ↓
保存到本地
    ↓
同步到 JSONBin（10秒超时）
    ↓
同步成功？
    ├─ 是 → 刷新界面 + 提示成功 ✅
    └─ 否 → 回滚操作 + 提示失败 ❌
```

### 容量说明

**仅使用 JSONBin**（不配置 GitHub）：
- 文章元数据：~500 字节/篇
- 文章内容：~5KB/篇（含内容）
- 支持约 20 篇文章

**使用 JSONBin + GitHub**（推荐）：
- 文章元数据：~500 字节/篇（存 JSONBin）
- 文章内容：存 GitHub（无限容量）
- 支持约 200 篇元数据 + 无限内容

---

## 🎯 同步机制

### 自动同步时机

1. **页面加载时**：自动从云端拉取最新数据
2. **发布文章/留言后**：立即同步到云端
3. **编辑文章后**：立即同步到云端
4. **删除文章/留言后**：立即同步到云端
5. **定期同步**：每 5 分钟自动同步
6. **页面切换回来时**：自动同步最新数据

### 超时保护

- **同步超时**：10 秒
- **超时后**：提示"同步超时，请检查网络连接"
- **操作回滚**：同步失败时自动回滚，保证数据一致性

### 错误处理

- **网络错误**：提示用户检查网络连接
- **超时错误**：提示用户稍后重试
- **权限错误**：提示用户检查 Token 权限
- **自动回滚**：失败时恢复到操作前的状态

---

## 🔧 技术栈

- **前端**：原生 JavaScript（无框架依赖）
- **编辑器**：Quill.js
- **云存储**：JSONBin.io（文章和留言数据）
- **文件存储**：GitHub API（文章内容和图片，可选）
- **缓存**：Service Worker
- **本地存储**：localStorage

---

## 🔄 版本更新机制

### 自动更新（无需用户操作）

修改 `app.js` 第 2 行的版本号：

```javascript
const APP_VERSION = '1.0.5'  // 更新版本号
```

用户打开网站时会自动：
1. ✅ 检测新版本
2. ✅ 清除所有旧缓存
3. ✅ 注销旧 Service Worker
4. ✅ 加载最新代码
5. ✅ 自动刷新页面

**用户无需按 Ctrl+F5 或手动清除缓存！**

---

## ⚡ 性能优化

### 缓存策略
- **HTML**：不缓存（始终最新）
- **CSS/JS**：Stale-While-Revalidate（先显示缓存，后台更新）
- **图片**：长期缓存

### 网络优化
- DNS 预解析（CDN、API）
- 资源预加载
- 图片懒加载
- 超时控制（10秒）

### 代码优化
- 事件委托（减少监听器）
- 防抖节流（减少调用）
- DocumentFragment（批量 DOM 更新）
- 异步操作（非阻塞）

---

## ❓ 常见问题

### Q1: 其他设备看不到我的文章？

**A**: 
1. 检查 `app.js` 中的 `JSONBIN_BIN_ID` 和 `JSONBIN_API_KEY` 是否配置正确
2. 打开浏览器控制台（F12）查看同步日志
3. 检查网络连接是否正常
4. 确认发布文章时提示"文章保存成功"

### Q2: 同步一直失败怎么办？

**A**: 
1. **检查网络**：确认能访问 `https://api.jsonbin.io`
2. **检查配置**：确认 Bin ID 和 API Key 正确
3. **查看控制台**：F12 查看详细错误信息
4. **重新配置**：如果 API Key 过期，重新生成

### Q3: 如何备份数据？

**A**: 
- 数据自动备份在 JSONBin 云端
- 可以在浏览器控制台导出本地数据：
```javascript
console.log(localStorage.getItem('myblog_posts'))
console.log(localStorage.getItem('myblog_msgs'))
```

### Q4: JSONBin 免费版有限制吗？

**A**: 
- 每月 10,000 次 API 调用
- 单个 Bin 最大 100KB
- 个人博客完全够用

### Q5: 为什么要配置 GitHub？

**A**: 
- **不配置**：文章内容存 JSONBin，容量限制 100KB（~20篇文章）
- **配置后**：文章内容存 GitHub，无容量限制，支持数千篇文章

### Q6: 同步超时是什么意思？

**A**: 
- 同步操作超过 10 秒未完成
- 可能原因：网络慢、服务器响应慢
- 解决方法：检查网络连接，稍后重试

---

## 🔐 安全建议

1. ⚠️ **不要将 API Key 提交到公开仓库**
2. ✅ 使用强密码作为管理员密码
3. ✅ 定期更换 API Key
4. ✅ 使用 HTTPS 部署网站
5. ✅ 定期备份数据

---

## 📝 更新日志

### v1.0.5 (2025-01-31)
- ✅ **重大优化**：移除手动同步按钮，改为自动同步
- ✅ 添加 10 秒同步超时保护
- ✅ 同步成功后才刷新界面并通知用户
- ✅ 同步失败时自动回滚操作
- ✅ 优化错误提示，更友好的用户体验
- ✅ 提升代码性能和稳定性

### v1.0.4 (2025-01-31)
- ✅ 改用 JSONBin.io 云数据库，实现真正的跨设备同步
- ✅ 移除 GitHub Token 配置，简化使用流程
- ✅ 优化自动同步机制
- ✅ 增强版本检测和缓存清除机制

### v1.0.3 (2025-01-30)
- ✅ 实现 GitHub 数据同步
- ✅ 添加自动版本检测
- ✅ 优化缓存策略

---

## 📞 联系方式

- **作者**：嵇志豪 (ZhoJimmy)
- **Email**：1839735394@qq.com
- **GitHub**：https://github.com/aurorarain

## 📄 许可证

MIT License

---

**感谢使用！如有问题欢迎反馈。🎉**
